version: "3"

services:
  acme_docker_hub:
    image: konradkleine/docker-registry-frontend:v2
    container_name: acme_docker_hub
    restart: always
    hostname: docker-hub
    domainname: acme.com
    ports:
      - 8003:80 # Debug
    environment:
      - ENV_DOCKER_REGISTRY_HOST=acme_docker_registry
      - ENV_DOCKER_REGISTRY_PORT=80
    depends_on:
      - acme_docker_registry
    networks:
      acme:
        aliases:
          - docker-hub.acme.com

  acme_docker_registry:
    image: registry:2
    container_name: acme_docker_registry
    restart: always
    hostname: docker-registry
    domainname: acme.com
    environment:
      - REGISTRY_HTTP_ADDR=0.0.0.0:80
    volumes:
      - acme_docker_registry:/var/lib/registry
    networks:
      acme:
        aliases:
          - docker-registry.acme.com
          - docker.acme.com

volumes:
  acme_docker_registry:
    external:
      name: acme_docker_registry

networks:
  acme:
    external:
      name: acme
